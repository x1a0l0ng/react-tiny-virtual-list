!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("react"),require("prop-types")):"function"==typeof define&&define.amd?define(["react","prop-types"],e):t.VirtualList=e(t.React,t.PropTypes)}(this,function(t,e){"use strict";function i(t,e){function i(){this.constructor=t}a(t,e),t.prototype=null===e?Object.create(e):(i.prototype=e.prototype,new i)}function o(t,e){var i={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&e.indexOf(o)<0&&(i[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols)for(var n=0,o=Object.getOwnPropertySymbols(t);n<o.length;n++)e.indexOf(o[n])<0&&(i[o[n]]=t[o[n]]);return i}var n,r,s,a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var i in e)e.hasOwnProperty(i)&&(t[i]=e[i])},l=Object.assign||function(t){for(var e,i=1,o=arguments.length;i<o;i++){e=arguments[i];for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])}return t},f="start",c="center",d="end",u="vertical",h="observed",p="requested",m=(n={},n[u]="scrollTop",n.horizontal="scrollLeft",n),g=(r={},r[u]="height",r.horizontal="width",r),S=(s={},s[u]="top",s.horizontal="left",s),z=function(){function t(t){var e=t.itemCount,i=t.itemSizeGetter,o=t.estimatedItemSize,n=t.containerSize,r=t.align,s=void 0===r?f:r;this.itemSizeGetter=i,this.itemCount=e,this.estimatedItemSize=o,this.containerSize=n,this.align=s,this.itemSizeAndPositionData={},this.lastMeasuredIndex=-1}return t.prototype.updateConfig=function(t){var e=t.itemCount,i=t.estimatedItemSize,o=t.containerSize,n=t.align,r=void 0===n?f:n;this.itemCount=e,this.estimatedItemSize=i,this.containerSize=o,this.align=r},t.prototype.getLastMeasuredIndex=function(){return this.lastMeasuredIndex},t.prototype.getSizeAndPositionForIndex=function(t){if(t<0||t>=this.itemCount)throw Error("Requested index "+t+" is outside of range 0.."+this.itemCount);if(t>this.lastMeasuredIndex){for(var e=this.getSizeAndPositionOfLastMeasuredItem(),i=e.offset+e.size,o=this.lastMeasuredIndex+1;o<=t;o++){var n=this.itemSizeGetter(o);if(null==n||isNaN(n))throw Error("Invalid size returned for index "+o+" of value "+n);this.itemSizeAndPositionData[o]={offset:i,size:n},i+=n}this.lastMeasuredIndex=t}return this.itemSizeAndPositionData[t]},t.prototype.getAlignOffset=function(){return this.align===c?(this.containerSize-this.estimatedItemSize)/2:this.align===d?this.containerSize-this.estimatedItemSize:0},t.prototype.getSizeAndPositionOfLastMeasuredItem=function(){return this.lastMeasuredIndex>=0?this.itemSizeAndPositionData[this.lastMeasuredIndex]:{offset:this.getAlignOffset(),size:0}},t.prototype.getTotalSize=function(){var t=this.getSizeAndPositionOfLastMeasuredItem(),e=this.align===c?(this.containerSize-this.estimatedItemSize)/2:0;return t.offset+t.size+(this.itemCount-this.lastMeasuredIndex-1)*this.estimatedItemSize+e},t.prototype.getUpdatedOffsetForIndex=function(t){var e=t.align,i=void 0===e?this.align:e,o=t.containerSize,n=t.currentOffset,r=t.targetIndex;if(o<=0)return 0;var s,a=this.getSizeAndPositionForIndex(r),l=a.offset,u=l-o+a.size;switch(i){case d:s=u;break;case c:s=l-(o-a.size)/2;break;case f:s=l;break;default:s=Math.max(u,Math.min(l,n))}var h=this.getTotalSize();return Math.max(0,Math.min(h-o,s))},t.prototype.getVisibleRange=function(t){var e=t.containerSize,i=t.offset,o=t.overscanCount;if(0===this.getTotalSize())return{};var n=i+e,r=this.findNearestItem(i);if(void 0===r)throw Error("Invalid offset "+i+" specified");var s=this.getSizeAndPositionForIndex(r);i=s.offset+s.size;for(var a=r;i<n&&a<this.itemCount-1;)a++,i+=this.getSizeAndPositionForIndex(a).size;return o&&(r=Math.max(0,r-o),a=Math.min(a+o,this.itemCount-1)),{start:r,stop:a}},t.prototype.resetItem=function(t){this.lastMeasuredIndex=Math.min(this.lastMeasuredIndex,t-1)},t.prototype.findNearestItem=function(t){if(isNaN(t))throw Error("Invalid offset "+t+" specified");t=Math.max(0,t);var e=this.getSizeAndPositionOfLastMeasuredItem(),i=Math.max(0,this.lastMeasuredIndex);return e.offset>=t?this.binarySearch({high:i,low:0,offset:t}):this.exponentialSearch({index:i,offset:t})},t.prototype.binarySearch=function(t){for(var e=t.low,i=t.high,o=t.offset,n=0,r=0;e<=i;){if(n=e+Math.floor((i-e)/2),(r=this.getSizeAndPositionForIndex(n).offset)===o)return n;r<o?e=n+1:r>o&&(i=n-1)}return e>0?e-1:0},t.prototype.exponentialSearch=function(t){for(var e=t.index,i=t.offset,o=1;e<this.itemCount&&this.getSizeAndPositionForIndex(e).offset<i;)e+=o,o*=2;return this.binarySearch({high:Math.min(e,this.itemCount-1),low:Math.floor(e/2),offset:i})},t}(),I={overflow:"auto",willChange:"scroll-position, top",WebkitOverflowScrolling:"touch"},v={position:"relative",overflow:"hidden",width:"100%",minHeight:"100%"},y={position:"absolute",left:0,width:"100%"},A=cancelAnimationFrame||webkitCancelAnimationFrame||clearTimeout,x=requestAnimationFrame||webkitRequestAnimationFrame||function(t){window.setTimeout(t,1e3/60)},O=function(t){return t<.5?4*t*t*t:(t-1)*(2*t-2)*(2*t-2)+1};return function(n){function r(){var t=null!==n&&n.apply(this,arguments)||this;return t.scrollAnimation=0,t.delayAlignment=0,t.scrollAnimating=!1,t.sizeAndPositionManager=new z({itemCount:t.props.itemCount,itemSizeGetter:function(e){return t.getSize(e)},estimatedItemSize:t.getEstimatedItemSize(),containerSize:t.props[g[t.props.scrollDirection||u]],align:t.props.scrollToAlignment}),t.state={offset:t.props.scrollOffset||null!=t.props.scrollToIndex&&t.getOffsetForIndex(t.props.scrollToIndex)||0,scrollChangeReason:p,scrolling:!1},t.styleCache={},t.findAlignedIndex=function(e){var i=t.props,o=i.scrollDirection,n=void 0===o?u:o,r=i.scrollToAlignment,s=t.props[g[n]],a=e;switch(r){case d:a+=s-t.getEstimatedItemSize();break;case c:a+=Math.round(s/2)}return t.sizeAndPositionManager.findNearestItem(a)},t.handleScroll=function(e){var i=t.props,o=i.onScroll,n=i.shouldScrollAlign,r=i.onAlign,s=t.getNodeOffset();s<0||t.state.offset===s||e.target!==t.rootNode||(t.setState({offset:s,scrollChangeReason:h,scrolling:n||!1}),n&&!t.scrollAnimating&&(clearTimeout(t.delayAlignment),t.delayAlignment=setTimeout(function(){var e=t.findAlignedIndex(s);t.scrollAnimTo(t.getOffsetForIndex(e)),t.setState({scrolling:!1}),"function"==typeof r&&r(e)},100)),"function"==typeof o&&o(s,e))},t.getRef=function(e){t.rootNode=e},t.getRootNode=function(){return t.rootNode||{}},t}return i(r,n),r.prototype.componentDidMount=function(){var t=this.props,e=t.scrollOffset,i=t.scrollToIndex;null!=e?this.scrollTo(e):null!=i&&this.scrollTo(this.getOffsetForIndex(i))},r.prototype.componentWillReceiveProps=function(t){var e=this.props,i=e.estimatedItemSize,o=e.itemCount,n=e.itemSize,r=e.scrollOffset,s=e.scrollToAlignment,a=e.scrollToIndex,l=e.scrollDirection,f=t.scrollToIndex!==a||t.scrollToAlignment!==s,c=t.itemCount!==o||t.itemSize!==n||t.estimatedItemSize!==i;t.itemCount===o&&t.estimatedItemSize===i&&t.scrollToAlignment===s&&t.scrollDirection==l||this.sizeAndPositionManager.updateConfig({itemCount:t.itemCount,estimatedItemSize:this.getEstimatedItemSize(t),containerSize:this.props[g[t.scrollDirection||l||u]],align:t.scrollToAlignment||s}),c&&this.recomputeSizes(),t.scrollOffset!==r?this.setState({offset:t.scrollOffset||0,scrollChangeReason:p}):"number"==typeof t.scrollToIndex&&(f||c)&&this.setState({offset:this.getOffsetForIndex(t.scrollToIndex,t.scrollToAlignment,t.itemCount),scrollChangeReason:p})},r.prototype.componentDidUpdate=function(t,e){var i=this.state,o=i.offset,n=i.scrollChangeReason;e.offset!==o&&n===p&&this.scrollTo(o)},r.prototype.getEstimatedItemSize=function(t){return void 0===t&&(t=this.props),t.estimatedItemSize||"number"==typeof t.itemSize&&t.itemSize||50},r.prototype.getNodeOffset=function(){var t=this.props.scrollDirection,e=void 0===t?u:t;return this.getRootNode()[m[e]]},r.prototype.scrollTo=function(t){var e=this.props.scrollDirection,i=void 0===e?u:e;this.getRootNode()[m[i]]=t},r.prototype.scrollAnimTo=function(t){var e=this;A(this.scrollAnimation),this.scrollAnimating=!0;var i=this.props.scrollDirection,o=void 0===i?u:i,n=(new Date).getTime(),r=this.getNodeOffset(),s=Math.round(t-r),a=Math.max(Math.abs(Math.round(2e3*s/this.sizeAndPositionManager.getTotalSize())),200),l=function(){var t=(new Date).getTime()-n,i=t>=a?1:O(t/a);e.getRootNode()[m[o]]=r+Math.ceil(s*i),i<1?e.scrollAnimation=x(l):e.scrollAnimating=!1};l()},r.prototype.getOffsetForIndex=function(t,e,i){void 0===e&&(e=this.props.scrollToAlignment),void 0===i&&(i=this.props.itemCount);var o=this.props.scrollDirection,n=void 0===o?u:o;return(t<0||t>=i)&&(t=0),this.sizeAndPositionManager.getUpdatedOffsetForIndex({align:e,containerSize:this.props[g[n]],currentOffset:this.state&&this.state.offset||0,targetIndex:t})},r.prototype.getSize=function(t){var e=this.props.itemSize;return"function"==typeof e?e(t):Array.isArray(e)?e[t]:e},r.prototype.getStyle=function(t){var e=this.styleCache[t];if(e)return e;var i=this.props.scrollDirection,o=void 0===i?u:i,n=this.sizeAndPositionManager.getSizeAndPositionForIndex(t),r=n.size,s=n.offset;return this.styleCache[t]=l({},y,(a={},a[g[o]]=r,a[S[o]]=s,a));var a},r.prototype.recomputeSizes=function(t){void 0===t&&(t=0),this.styleCache={},this.sizeAndPositionManager.resetItem(t)},r.prototype.render=function(){var e=this.props,i=(e.estimatedItemSize,e.height),n=e.overscanCount,r=void 0===n?3:n,s=e.renderItem,a=(e.itemCount,e.itemSize,e.onItemsRendered),f=(e.onScroll,e.onAlign,e.scrollDirection),c=void 0===f?u:f,d=(e.scrollOffset,e.scrollToIndex,e.scrollToAlignment,e.shouldScrollAlign,e.style),h=e.width,p=o(e,["estimatedItemSize","height","overscanCount","renderItem","itemCount","itemSize","onItemsRendered","onScroll","onAlign","scrollDirection","scrollOffset","scrollToIndex","scrollToAlignment","shouldScrollAlign","style","width"]),m=this.state,S=m.offset,z=m.scrolling,y=this.sizeAndPositionManager.getVisibleRange({containerSize:this.props[g[c]]||0,offset:S,overscanCount:r}),A=y.start,x=y.stop,O=[];if(void 0!==A&&void 0!==x){for(var M=A;M<=x;M++)O.push(s({index:M,style:this.getStyle(M)}));"function"==typeof a&&a({startIndex:A,stopIndex:x})}return t.createElement("div",l({ref:this.getRef},p,{onScroll:this.handleScroll,style:l({},I,d,{height:i,width:h})}),t.createElement("div",{className:z?"scrolling":"",style:l({},v,(T={},T[g[c]]=this.sizeAndPositionManager.getTotalSize(),T))},O));var T},r.defaultProps={overscanCount:3,scrollDirection:u,width:"100%",shouldScrollAlign:!1},r.propTypes={estimatedItemSize:e.number,height:e.oneOfType([e.number,e.string]).isRequired,itemCount:e.number.isRequired,itemSize:e.oneOfType([e.number,e.array,e.func]).isRequired,onItemsRendered:e.func,overscanCount:e.number,renderItem:e.func.isRequired,scrollOffset:e.number,scrollToIndex:e.number,scrollToAlignment:e.oneOf(["auto",f,c,d]),scrollDirection:e.oneOf(["horizontal",u]).isRequired,width:e.oneOfType([e.number,e.string]).isRequired,shouldScrollAlign:e.bool},r}(t.PureComponent)});
